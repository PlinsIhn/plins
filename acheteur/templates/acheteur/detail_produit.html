{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{% static 'css/bootstrap/css/bootstrap.min.css' %}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

        <title>detail</title>
    </head>

    <body style="padding-bottom: 80px; background-color: rgb(250, 250, 251);">
        
        <div class="container-fluid p-3">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8 col-xxl-7">
                    <!-- Image principale du produit -->
                    <div class="position-relative">
                        <!-- script 1  Carousel -->
                        <div id="carouselProduitComplet" class="carousel slide mb-1" data-bs-interval="false" data-bs-ride="false">
                            <div class="carousel-inner">

                            <!-- Image principale -->
                            <div class="carousel-item active">
                                <img src="{{ produit.image_profil_produit.url }}" class="d-block mx-auto rounded"
                                    style="height: 220px; width: auto; max-width: 100%;" alt="Image principale"
                                    onerror="this.src='https://via.placeholder.com/250'">
                            </div>

                            <!-- Variations -->
                            {% for var in variations %}
                                {% if var.image_variation %}
                                <div class="carousel-item">
                                <img src="{{ var.image_variation.url }}" class="d-block mx-auto rounded"
                                    style="height: 220px; width: auto; max-width: 100%;" alt="{{ var.nom_variation }}"
                                    onerror="this.src='https://via.placeholder.com/250'">
                                </div>
                                {% endif %}
                            {% endfor %}
                            </div>

                            <!-- Contrôles -->
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselProduitComplet" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselProduitComplet" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            </button>

                            <!-- Compteur en bas à droite -->
                            <div id="carouselCounter" class="position-absolute bottom-0 end-0 mb-2 me-2 bg-secondary text-white px-2 py-1 rounded" style="font-size: 0.7em; z-index: 10;">
                            1 / 1
                            </div>
                        </div>

                        <!-- Miniatures -->
                        <div class="d-flex justify-content-start mt-2 gap-2 flex-nowrap overflow-x-auto overflow-y-hidden"
                            style="white-space: nowrap;">
                            <!-- Miniature image principale -->
                            <img src="{{ produit.image_profil_produit.url }}"
                                class="img-thumbnail miniature-image border border-primary flex-shrink-0"
                                data-bs-target="#carouselProduitComplet"
                                data-bs-slide-to="0"
                                style="height: 50px; width: auto; cursor: pointer;"
                                onerror="this.src='https://via.placeholder.com/60'">

                            {% for var in variations %}
                                {% if var.image_variation %}
                                <img src="{{ var.image_variation.url }}"
                                    class="img-thumbnail miniature-image flex-shrink-0"
                                    data-bs-target="#carouselProduitComplet"
                                    data-bs-slide-to="{{ forloop.counter }}"
                                    style="height: 50px; width: auto; cursor: pointer;"
                                    onerror="this.src='https://via.placeholder.com/60'">
                                {% endif %}
                            {% endfor %}
                        </div>


                    </div>

                    <!-- Informations générales -->
                    <div class="card my-2 p-2">
                        <p>
                            <span style="color: rgb(22, 22, 186); font-weight: bold; font-size: 0.9em;">
                                {% if produit.promo_est_active %}
                                    {% if prix_min == prix_max %}
                                        <span class="text-muted text-decoration-line-through">{{ ancien_prix_min }} Ar</span>
                                        <span class="text-danger fw-bold">{{ prix_min }} Ar (Promo!)</span>
                                    {% else %}
                                        <span class="text-muted text-decoration-line-through">{{ ancien_prix_min }} Ar ~ {{ ancien_prix_max }} Ar</span>
                                        <span class="text-danger fw-bold">{{ prix_min }} Ar ~ {{ prix_max }} Ar (Promo!)</span>
                                    {% endif %}
                                    <span> hatramin'ny {{ produit.promo_fin }} </span>
                                {% else %}
                                    {% if prix_min == prix_max %}
                                        <span>{{ prix_min }} Ar</span>
                                    {% else %}
                                        <span>{{ prix_min }} Ar ~ {{ prix_max }} Ar</span>
                                    {% endif %}
                                {% endif %}

                            </span>
                            <span style="font-weight: bold;">|</span>
                            <span style="color: rgb(255, 0, 0); font-size: 0.8em;">
                                 {{ produit.moq }} minimum
                            </span>
                        </p>
                    
                        <h4 class="card-title">{{ produit.nom_produit }}</h4>
                        <p class="card-text">{{ produit.description }}</p>
                        <p class="card-text">mot clet de recherche : {{ produit.mot_clet }}</p>
                    </div>
                    
                    <div class="card my-2 p-2">
                        <div class="card">
                            <div class="card-header bg-warning text-white">
                                <i class="bi bi-truck"></i> Informations de livraison
                            </div>
                            <div class="card-body">
                                {% if produit.modele_livraison %}
                                <h5 class="card-title">{{ produit.modele_livraison.nom }}</h5>
                                <p class="card-text">
                                    <strong>Délai generale :</strong> {{ produit.modele_livraison.delai_livraison_generale }}
                                </p>
                                {% else %}
                                <div class="alert alert-warning mb-0">
                                    <strong>Modèle de livraison :</strong> Ce produit n'est pas livrable.
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- fournisseur -->
                    <div class="card my-2 p-2">
                        <div style="font-size: 0.8em; border-top-left-radius: 5px; border-top-right-radius: 5px;" class="pb-2 text-center">
                            <span style="font-weight: bold;">plateforme </span>
                            <span style="color: rgb(239, 1, 187);">plins ...</span></span>
                        </div>
                        <div class="d-flex align-items-center p-1 border mb-2" style="border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; ">
                            {% if produit.magasin.logo %}
                                <img src="{{ produit.magasin.logo.url }}" alt="Logo du magasin" class="rounded-circle me-3" width="65" height="65">
                            {% else %}
                                <img src="{% static 'images/logo_pardefaut.jpg' %}" alt="Logo par défaut" class="rounded-circle me-3" width="65" height="65">
                            {% endif %}

                            <div>
                                <p class="mb-1 fw-bold" style="font-size: 1.1em;">{{ produit.magasin.nom_magasin }}</p>
                                {% if produit.magasin.vendeur.is_active %}
                                <span class="badge" style="background-color: rgb(32, 238, 13);"> Activé</span>
                                {% else %}
                                <span class="badge bg-danger"> Non activé</span>
                                {% endif %}
                            </div>
                        </div>

                        <p class="mb-1"><strong>Téléphone :</strong> {{ produit.magasin.vendeur.phone }}</p>
                        <p class="mb-1"><strong>Adresse :</strong> {{ produit.magasin.adresse_magasin }}</p>
                        <p class="mb-0"><strong>Inscription :</strong> {{ produit.magasin.date_inscription }}</p>
                    </div>

                    <!-- Détails supplémentaires -->
                    <div class="card my-2 p-2">
                        <h4 class="mt-2 mb-3">Details : </h4>
                        <div class="row">
                        {% for detail in details %}
                            {% if detail.detaille_file %}
                            <!-- Vidéo avec largeur contrôlée -->
                            <div class="col-12 col-lg-8 mx-lg-auto mb-3">  <!-- 66.6% de largeur sur PC -->
                                <div class="card shadow-sm">
                                <div class="ratio ratio-16x9">
                                    <video controls class="rounded">
                                    <source src="{{ detail.detaille_file.url }}" type="video/mp4">
                                    Votre navigateur ne supporte pas la vidéo.
                                    </video>
                                </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if detail.detaille_image %}
                            <!-- Images (affichage grid) -->
                            <div class="col-12 col-sm-6 my-2">
                                <div class="card h-100 border-0 shadow-sm">
                                <img src="{{ detail.detaille_image.url }}" 
                                    class="card-img-top object-fit-contain"
                                    style="height: auto;"
                                    alt="Détail produit">
                                </div>
                            </div>
                            {% endif %}
                        {% empty %}
                            <div class="col-12">
                            <div class="alert alert-info">Aucun média disponible</div>
                            </div>
                        {% endfor %}
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <!-- Footer fixe en bas -->
        <footer class="fixed-bottom bg-light border-top py-2">
            <div class="container">
                <div class="d-flex justify-content-around text-center">
                    <a href="{% url 'liste_produits' %}" class="text-dark text-decoration-none">
                        <i class="bi bi-bag-check"></i><br><small>produits</small>
                    </a>
                <a href="#" class="text-dark text-decoration-none">
                    <i class="bi bi-shop"></i><br><small>Magasin</small>
                </a>
                <a href="#" class="text-dark text-decoration-none">
                    <i class="bi bi-chat-dots"></i><br><small>Message</small>
                </a>
                <a href="#" class="text-dark text-decoration-none">
                    <i class="bi bi-cart"></i><br><small>Panier</small>
                </a>
                <a href="#" class="text-dark text-decoration-none">
                    <i class="bi bi-bag-check"></i><br><small>Commander</small>
                </a>

                </div>
            </div>
        </footer>

            <!-- modal d'image, script 2 -->
        <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content bg-transparent border-0">
                <div class="modal-body p-0 position-relative">

                    <div id="modalCarousel" class="carousel slide" data-bs-interval="false" data-bs-ride="false">
                    <div class="carousel-inner" id="modalCarouselInner">
                        <!-- Images insérées dynamiquement par JS -->
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#modalCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#modalCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                    </div>

                </div>
                </div>
            </div>
        </div>

        <script src="{% static 'js/detail_produit.js' %}"></script>

        <script src="{% static 'js/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js' %}"></script>
    </body>
</html>