
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/bootstrap/css/bootstrap.min.css' %}">

      <!-- Bloc pour CSS additionnel -->
    {% block extra_css %} {% endblock %}

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <title>plins</title>
</head>
<body style="padding-bottom: 80px;">

    <!-- Loader global -->
  <div id="loader" style="display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); z-index:1050;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Scripts globaux -->
<script>
  function showLoader() {
  document.getElementById("loader").style.display = "block";
}

function hideLoader() {
  document.getElementById("loader").style.display = "none";
}

// Exemple avec fetch
function fetchWithLoader(url, options) {
  showLoader();
  return fetch(url, options)
    .finally(() => hideLoader());
}

// Exemple d’utilisation
document.addEventListener("click", function(e){
  if(e.target.matches(".ajax-link")) {
    e.preventDefault();
    fetchWithLoader(e.target.href)
      .then(res => res.text())
      .then(html => {
        document.getElementById("content").innerHTML = html;
      });
  }
});

</script>
  <header class="sticky-top bg-light border-bottom" style="z-index: 1030;">
    {% if magasin %}
        <div class="d-flex flex-wrap align-items-center justify-content-between p-2">
          <div class="d-flex align-items-center flex-grow-1 mb-2 mb-md-0">
              {% if magasin.logo %}
                  <img src="{{ magasin.logo.url }}" alt="Logo" class="me-2 rounded-circle" width="50" height="50">
              {% else %}
                  <img src="{% static 'images/logo_pardefaut.jpg' %}" alt="Logo par défaut" class="me-2 rounded-circle" width="50" height="50">
              {% endif %}
              <div class="text-truncate" style="width: 150px;">
                  <strong>{{ magasin.nom_magasin }}</strong><br>
                  <small>{{ user.phone }}</small>
              </div>
          </div>
          <div class="d-flex align-items-center gap-3 ">
            <a href="#">
              <i class="bi bi-chat-text p-2 text-dark" ></i>
            </a>
            <a href="{% url 'vendeur_profil' %}" class="text-decoration-none p-2 text-dark" style="margin-right: 15px;">
              <i class="bi bi-person fs-5"></i><br>
            </a>
          </div>
        </div>
      {% else %}
      <div class="container" style="font-weight: bold;color: red;">
          <p class="p-2 text-center small">Vous n'avez pas encore créé de magasin.</p> 
      </div>
    {% endif %}
  </header>

  <div id="ajax-message" class="mt-3" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>


<!-- ✅ Messages flash -->
{% if messages %}
  <div class="messages-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
    {% for message in messages %}
      <div style="color: rgb(0, 9, 94); padding: 10px 15px; border-radius: 5px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"
            class="alert 
             {% if message.tags == 'success' %} alert-success
             {% elif message.tags == 'error' %} alert-danger
             {% elif message.tags == 'warning' %} alert-warning
             {% elif message.tags == 'info' %} alert-info
             {% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>

  <script>
    setTimeout(() => {
      const container = document.querySelector('.messages-container');
      if (container) {
        container.style.transition = "opacity 0.5s ease-out";
        container.style.opacity = 0;
        setTimeout(() => container.remove(), 500);
      }
    }, 3000);
  </script>
{% endif %}



{% if '/vendeur/produit' in request.path %}
<!-- Header sticky contenant les liens -->
<div id="nav-boutons" class="bg-white border-bottom py-2 px-3 sticky-top d-flex justify-content-center gap-2" style="top: 70px; z-index: 1040;">
  <a href="{% url 'produit_vendeur' %}" class="btn btn-sm btn-outline-secondary" id="btn-produit">Produit</a>
  <a href="{% url 'ajouter_produit' %}" class="btn btn-sm btn-outline-secondary" id="btn-ajouter">Ajouter</a>
  <a href="#" class="btn btn-sm btn-outline-secondary" id="btn-nouveau">Nouveau</a>
  <a href="#" class="btn btn-sm btn-outline-secondary" id="btn-promo">Promo</a>
</div>


{% endif %}

      <div class="container-fluid p-2">
        {% block content %}     
        
        {% endblock %}  
      </div>

        {% block scripts %}      {% endblock %}

{% url 'vendeur_dashboard' as dashboard_url %}
{% url 'produit_vendeur' as produit_url %}
{% url 'ajout_model_livraison' as livraison_url %}

{% with request.path as current_path %}
<footer class="fixed-bottom bg-light border-top">
  <div class="d-flex justify-content-around text-center py-2">

    <!-- Bouton Accueil -->
    <a href="{% url 'vendeur_dashboard' %}" class="text-decoration-none 
      {% if current_path == '/' or current_path == dashboard_url %}text-primary{% else %}text-dark{% endif %}">
      <i class="bi bi-house-door{% if current_path == '/' or current_path == dashboard_url %}-fill{% endif %} fs-5"></i><br>
      <small>Accueil</small>
    </a>

    <!-- Bouton Produits -->
    <a href="{% url 'produit_vendeur' %}" class="text-decoration-none 
      {% if '/vendeur/produit' in current_path %}text-primary{% else %}text-dark{% endif %}">
      <i class="bi bi-box-seam{% if '/vendeur/produit' in current_path %}-fill{% endif %} fs-5"></i><br>
      <small>Produits</small>
    </a>

    <!-- Bouton Commande (à adapter plus tard si tu crées une URL) -->
    <a href="#" class="text-dark text-decoration-none">
      <i class="bi bi-receipt fs-5"></i><br>
      <small>Commande</small>
    </a>

    <a href="{% url 'liste_modele_livraison' %}" class=" text-decoration-none
      {% if 'vendeur/frais/modele-livraison/liste' in current_path %}text-primary{% else %}text-dark{% endif %}">
        <i class="bi bi-truck {% if 'vendeur/frais/modele-livraison/liste' in current_path %} text-primary fw-bold{% endif %} fs-5"></i><br>
        <small>Frais</small>
    </a>


  </div>

  <!-- script pour le mini bouton active -->
   <script>
  document.addEventListener("DOMContentLoaded", function () {
    const path = window.location.pathname;

    // Active le bon bouton selon l'URL
    if (path.includes("ajouter")) {
      activerBouton("btn-ajouter");
    } else if (path.includes("nouveau")) {
      activerBouton("btn-nouveau");
    } else if (path.includes("promo")) {
      activerBouton("btn-promo");
    } else if (path.includes("produit")) {
      activerBouton("btn-produit");
    }

    function activerBouton(id) {
      const bouton = document.getElementById(id);
      if (bouton) {
        bouton.classList.remove("btn-outline-secondary");
        bouton.classList.add("btn-warning");
      }
    }
  });
</script>

</footer>
{% endwith %}



<!-- Overlay modal d'ajout de produit -->
<div class="modal fade" id="uploadOverlay" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: rgba(0,0,0,0.7); border:none; box-shadow:none;">
      <div class="modal-body text-center text-white">
        <div class="spinner-border text-light" role="status" style="width: 4rem; height: 4rem;">
          <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="mt-3">Ajout du produit en cours, veuillez patienter...</p>
      </div>
    </div>
  </div>
</div>



</body>
</html>